<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Donation Verified – FundTrackerAI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div class="app-shell">
    <div class="card">

      <!-- HEADER -->
      <div class="header-card">
        <h1>FundTrackerAI</h1>
        <p>Verified Transaction System</p>
      </div>

      <h2 style="margin-bottom:6px;">Payment Status</h2>
      <p style="margin-top:0;margin-bottom:14px;color:#9ca3af;">
        Your transaction has been securely processed.
      </p>

      <!-- VERIFIED BADGE -->
      <div style="
        width:100%;
        padding:10px;
        margin-bottom:20px;
        border-radius:10px;
        text-align:center;
        background:rgba(22,163,74,0.15);
        border:1px solid rgba(34,197,94,0.5);
        color:#86efac;">
        Payment Verified ✓
      </div>

      <!-- DONATION DETAILS -->
      <div class="section">

        <div class="form-row">
          <label>Name</label>
          <div id="donorName" style="font-weight:600;">Loading...</div>
        </div>

        <div class="form-row">
          <label>Email</label>
          <div id="donorEmail" class="identity-pill"></div>
        </div>

        <div class="form-row">
          <label>Amount</label>
          <div id="donorAmount" style="font-weight:600;">Loading...</div>
        </div>

        <div class="form-row">
          <label>Reference ID</label>

          <div style="display:flex;align-items:center;gap:10px;">
            <div id="maskedRef" style="
              font-family:monospace;
              letter-spacing:1px;
              padding:6px 10px;
              background:rgba(30,41,59,0.8);
              border-radius:8px;
              color:#e5e7eb;">
              ************
            </div>

            <button id="revealBtn" class="copy-btn" style="
              background:#facc15;
              color:#1f2937;
              border:1px solid #eab308;
            ">
              Reveal SoulMarkⓈ →
            </button>
          </div>

        </div>

        <p style="margin-top:20px;font-size:0.85rem;color:#9ca3af;line-height:1.45;">
          To access your full verified SoulMark and your real-time impact dashboard,
          create your iAscendAi username below.
        </p>

        <!-- CONTINUE -->
        <button id="continueBtn" class="primary-btn" style="width:100%;margin-top:14px;">
          Reveal My Verified SoulMarkⓈ →
        </button>

      </div>

    </div>
  </div>

  <script>
    async function loadVerification() {
      const params = new URLSearchParams(window.location.search);
      const sessionId = params.get("session_id");

      if (!sessionId) {
        document.getElementById("donorName").innerText = "Error";
        return;
      }

      try {
        const res = await fetch(`/verify-donation/${sessionId}`);
        const data = await res.json();

        if (data.error) {
          alert("Error verifying donation: " + data.error);
          return;
        }

        // Display fields
        document.getElementById("donorName").innerText = data.name;
        document.getElementById("donorEmail").innerText = data.email;
        document.getElementById("donorAmount").innerText =
          "$" + Number(data.amount).toFixed(2);

        // Store for register.html handoff
        localStorage.setItem("donor_name", data.name);
        localStorage.setItem("donor_email", data.email);
        localStorage.setItem("donor_amount", data.amount);
        localStorage.setItem("donor_soulmark", data.soulMark);

        // Masked reference
        const masked =
          data.soulMark.substring(0, 4) +
          "••••••••••" +
          data.soulMark.substring(data.soulMark.length - 4);

        document.getElementById("maskedRef").innerText = masked;

        // Reveal button shows masked explanation ONLY
        document.getElementById("revealBtn").onclick = () => {
          alert("Create your identity to reveal your full SoulMark.");
        };

        // Continue to register
        document.getElementById("continueBtn").onclick = () => {
          window.location.href = "register.html";
        };

      } catch (err) {
        alert("Verification failed.");
      }
    }

    loadVerification();
  </script>
</body>
</html>
