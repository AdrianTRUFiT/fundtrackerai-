<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<div class="card">
  <h2>Payment Status</h2>
  <div id="result" class="status">Checking...</div>

  <p id="soulmarkBox" class="soulmark" style="display:none;"></p>

  <a href="dashboard.html" id="dashboardBtn" class="btn" style="display:none;">
    View Donation Dashboard
  </a>
</div>

<script>
async function verify() {
  const params = new URLSearchParams(window.location.search);
  const id = params.get("session_id");

  const resultEl = document.getElementById("result");
  const soulmarkBox = document.getElementById("soulmarkBox");
  const btn = document.getElementById("dashboardBtn");

  if (!id) {
    resultEl.innerText = "Invalid session ❌";
    resultEl.classList.add("fail");
    return;
  }

  const res = await fetch(`https://fundtrackerai.onrender.com/verify-donation/${id}`);
  const data = await res.json();

  if (data.verified) {
    resultEl.innerText = "Payment Verified ✔";
    resultEl.classList.add("success");

    // Show SoulMark
    soulmarkBox.style.display = "block";
    soulmarkBox.innerText = "SoulMark: " + data.entry.soulmark;

    btn.style.display = "inline-block";
  } else {
    resultEl.innerText = "Verification Failed ❌";
    resultEl.classList.add("fail");
  }
}

verify();
</script>

</body>
</html>