<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Jamaica We Rise — Campaign View</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div class="app-shell">
    <div class="card">

      <div class="brand-row">
        <div class="brand-mark">Jamaica Flag</div>
        <div>
          <h1>Jamaica We Rise</h1>
          <h2>Live Impact Overview</h2>
        </div>
      </div>

      <p class="subtext">
        This view shows live totals from all FundTrackerAI donations currently
        linked to this campaign.
      </p>

      <div class="dash-card">
        <div class="dash-title">Campaign Stats</div>

        <p class="small-label">Total Raised</p>
        <div id="totalAmount" class="value">$0.00</div>

        <p class="small-label" style="margin-top:10px;">Total Verified Donors</p>
        <div id="totalDonors" class="value">0</div>
      </div>

      <!-- CHANGED: No more table — now a clean vertical list -->
      <div class="dash-card">
        <div class="dash-title">Recent Verified Donations</div>
        
        <div class="donations-list" id="donationRows">
          <!-- JavaScript will fill this with beautiful vertical cards -->
          <div class="donation-item loading">Loading…</div>
        </div>
      </div>

      <button class="btn-secondary" onclick="goBack()">
        Back to iAscendAi Dashboard
      </button>

    </div>
  </div>

  <script>
    const BACKEND_URL = "https://fundtrackerai.onrender.com";

    async function loadDonations() {
      const container = document.getElementById("donationRows");
      const totalAmountEl = document.getElementById("totalAmount");
      const totalDonorsEl = document.getElementById("totalDonors");

      try {
        const res = await fetch(`${BACKEND_URL}/donations`);
        const data = await res.json();
        const donations = data.donations || [];

        // Update totals
        if (donations.length === 0) {
          container.innerHTML = '<div class="donation-item empty">No donations recorded yet.</div>';
          totalAmountEl.textContent = "$0.00";
          totalDonorsEl.textContent = "0";
          return;
        }

        const totalAmount = donations.reduce((sum, d) => sum + (d.amount || 0), 0);
        totalAmountEl.textContent = "$" + (totalAmount / 100).toFixed(2);
        totalDonorsEl.textContent = donations.length.toString();

        // Sort newest first
        const sorted = donations
          .slice()
          .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

        const itemsHTML = sorted.map(d => {
          const name = d.name && d.name.trim() ? d.name : "Donor";
          ";
          const amount = "$" + ((d.amount || 0) / 100).toFixed(2);

          const date = d.timestamp ? new Date(d.timestamp) : null;
          const dateStr = date ? date.toLocaleDateString('en-US', { month: 'numeric', day: 'numeric', year: 'numeric' }) : "N/A";
          const timeStr = date ? date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true }) : "";

          return `
            <div class="donation-item">
              <div class="donor-name">${name}</div>
              <div class="donation-amount">${amount}</div>
              <div class="donation-date">${dateStr}</div>
              <div class="donation-time">${timeStr}</div>
            </div>
          `;
        }).join("");

        container.innerHTML = itemsHTML;

      } catch (err) {
        console.error(err);
        container.innerHTML = '<div class="donation-item error">Error loading donations.</div>';
      }
    }

    function goBack() {
      window.location.href = "iascendai-dashboard.html";
    }

    // Load immediately
    loadDonations();
  </script>
</body>
</html>